-- Create the database
CREATE DATABASE IF NOT EXISTS kma_log_system;
USE kma_log_system;

-- Create the departments table
CREATE TABLE IF NOT EXISTS departments (
    id INT AUTO_INCREMENT PRIMARY KEY,
    name VARCHAR(255) NOT NULL
);

-- Create the employees table
CREATE TABLE IF NOT EXISTS employees (
    id INT AUTO_INCREMENT PRIMARY KEY,
    staff_id VARCHAR(50) UNIQUE NOT NULL,
    name VARCHAR(255) NOT NULL,
    department_id INT,
    phone VARCHAR(20),
    email VARCHAR(255) UNIQUE,
    position VARCHAR(100),
    date_of_birth DATE,
    hire_date DATE,
    password VARCHAR(255) NOT NULL,
    is_admin BOOLEAN DEFAULT FALSE,
    FOREIGN KEY (department_id) REFERENCES departments(id)
);

-- Create the files table
CREATE TABLE IF NOT EXISTS files (
    id INT AUTO_INCREMENT PRIMARY KEY,
    year INT NOT NULL,
    month VARCHAR(20) NOT NULL,
    date_received DATE NOT NULL,
    log_time TIME NOT NULL,
    serial_no VARCHAR(50) NOT NULL,
    from_whom_received VARCHAR(255) NOT NULL,
    date_of_letter DATE NOT NULL,
    letter_ref_no VARCHAR(100) NOT NULL,
    received_by INT,
    type_of_letter ENUM('Official', 'Unofficial', 'Dispatched', 'Income') NOT NULL,
    subject TEXT NOT NULL,
    file_process ENUM('incoming', 'outgoing', 'pending') NOT NULL,
    attached_file VARCHAR(255),
    department_id INT,
    FOREIGN KEY (received_by) REFERENCES employees(id),
    FOREIGN KEY (department_id) REFERENCES departments(id)
);

-- Insert default departments
INSERT INTO departments (name) VALUES
('Budget'),
('Metro Chief Executive''s Office'),
('Metro Coordinating Director'),
('Planning'),
('Records');

-- Insert a default admin user (you should change the password)
INSERT INTO employees (staff_id, name, department_id, email, position, password, is_admin)
VALUES ('ADMIN001', 'System Administrator', 1, 'admin@kma.gov.gh', 'Administrator', 'change_this_password', TRUE);
